#!/bin/sh

set -e
set -u

major_version () {
   local version="$1"
   echo "$version" | perl -p -E 's,[.].*,,'
}

RELEASING_VERSION="$1"
RELEASING_MAJOR_VERSION=$(major_version "$RELEASING_VERSION")

git tag | while read tag ; do
   version=$(echo "$tag" | perl -p -E 's,-,~,')
   major_version=$(major_version "$version")
   if [ "$major_version" = "$RELEASING_MAJOR_VERSION" ] && \
         dpkg --compare-versions "$version" lt "$RELEASING_VERSION" ; then
      echo "$version"
   fi
done

