[[!meta title="Upgrading custom packages for VeraCrypt support"]]

Until Tails is based on a Debian version which includes our patches
We have to maintain our custom packages for the integration of VeraCrypt
support in GNOME until they are available in Tails via the Debian repos
(for some that will be Buster, for some Bullseye). This means we need to
check if new versions of the following source packages hit Debian stable:

* [udisks2](https://packages.debian.org/source/stable/udisks2) (version in Tails 3.9: 2.1.8-1.0tails3)
* [gnome-disk-utility](https://packages.debian.org/source/stable/gnome-disk-utility) (version in Tails 3.9: 3.22.1-1.0tails1)
* [glib2.0](https://packages.debian.org/source/stable/glib2.0) (version in Tails 3.9: 2.50.3-2.0tails3)
* [gtk+3.0](https://packages.debian.org/source/stable/gtk+3.0) (version in Tails 3.9: 3.22.11-1.0tails5)
* [gvfs](https://packages.debian.org/source/stable/gvfs) (version in Tails 3.9: 1.30.4-1.0tails5)
* [gobject-introspection](https://packages.debian.org/source/stable/gobject-introspection) (version in Tails 3.9: 1.50.0-1.0tails2)
* [gjs](https://packages.debian.org/source/stable/gjs) (version in Tails 3.9: 1.46.0-1.0tails2)
* [gnome-shell](https://packages.debian.org/source/stable/gnome-shell) (version in Tails 3.9: 3.22.3-3.0tails6)

If any of these have a new version in Debian stable:

1. Download our custom package and source package it is was forked off from:

       sudo tee /etc/apt/sources.list.d/tails-3.9.list <<EOF
       deb     [check-valid-until=no] tor+http://jenw7xbd6tf7vfhp.onion/ 3.9 main
       deb-src [check-valid-until=no] tor+http://jenw7xbd6tf7vfhp.onion/ 3.9 main
       deb     [check-valid-until=no] tor+http://snapshot.debian.org/archive/debian/20180904T000000Z/ stretch main
       deb-src [check-valid-until=no] tor+http://snapshot.debian.org/archive/debian/20180904T000000Z/ stretch main
       EOF
       sudo apt update
       # Replace udisks2 with the source package and the version with the
       # version in Tails 3.9 and the original version
       apt source --download-only udisks2=2.1.8-1.0tails3
       apt source --download-only udisks2=2.1.8-1

1. Get the debdiff of our patches:

       debdiff udisks2_2.1.8-1.dsc udisks2_2.1.8-1.0tails3.dsc >> tails.diff

1. Download the new source package:

       apt source udisks2

1. Apply the debdiff on the new version:

       debdiff-apply udisks2*/ tails.diff

1. Add changelog entry and build a new version of the patched package:

       cd udisks2*/
       # XXX: Set distribution field to XXX
       debchange -i
       pdebuild

1. Install the newly built package in the build environment and rebuild all
   custom packages which depend on it. The dependencies are as follows (where
   `X: Y` means that `X` is dependency of `Y`):

    * `udisks2`: `gnome-disk-utility`
    * `glib2.0`: `gtk+3.0`, `gvfs`, `gobject-introspection`, `gjs`, `gnome-shell`
    * `gobject-introspection`: `gjs`
    * `gjs`: `gnome-shell`

1. XXX: Sign and upload updated packages
