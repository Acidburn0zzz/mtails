<!DOCTYPE html>

<html lang="ar" dir="rtl" xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tails - Claws Mail leaks plaintext of encrypted emails to IMAP server</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="icon" href="../favicon.ico" type="image/x-icon" />

<link rel="stylesheet" href="../style.css" type="text/css" />

<link rel="stylesheet" href="../local.css" type="text/css" />


<script src="../lib/js/mirror-dispatcher.js" type="text/javascript"></script>









</head>


<body class="ar">


<div class="searchform">



</div>

<div class="banner" role="banner">
  <a class="tails" href="../index.ar.html">
    <span class="acronym">Tails</span><br/>
    <span class="slogan">The Amnesic Incognito Live System</span>
  </a>
</div>

<div class="page">

<div class="pageheader">
<div class="header">
<span>
<span class="parentlinks">
<ul id="crumbs">
<li><a href="../index.ar.html"><img src="../lib/home.png"></a></li>







<li><a href="../security.ar.html">security</a></li>




<li>Claws Mail leaks plaintext of encrypted emails to IMAP server</li>

</ul>
</span>
<span class="title">
Claws Mail leaks plaintext of encrypted emails to IMAP server
</span>
<span class="date">Thu 07 May 2015 12:34:56 PM UTC</span>
</span>
</div>




<div id="otherlanguages">
<ul>
   
   <li class="current">
   <span class="visible">Arabic
(8&nbsp;%)
   </span>
   <span class="hidden">Arabic
(8&nbsp;%)
   </span>
   </li>

   


   

   <li  class="master">

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.en.html">en</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.en.html">English
    : master 
   </a>
   </span>

   </li>
   

   <li >

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.ca.html">ca</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.ca.html">Catalan
   (5%)
   </a>
   </span>

   </li>
   

   <li >

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.de.html">de</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.de.html">Deutsch
   (5%)
   </a>
   </span>

   </li>
   

   <li >

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.es.html">es</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.es.html">EspaÃ±ol
   (8%)
   </a>
   </span>

   </li>
   

   <li >

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.fa.html">fa</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.fa.html">Farsi
   (98%)
   </a>
   </span>

   </li>
   

   <li >

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.fr.html">fr</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.fr.html">Français
   (98%)
   </a>
   </span>

   </li>
   

   <li >

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.it.html">it</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.it.html">Italiano
   (7%)
   </a>
   </span>

   </li>
   

   <li >

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.pl.html">pl</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.pl.html">Polish
   (8%)
   </a>
   </span>

   </li>
   

   <li >

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.pt.html">pt</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.pt.html">PortuguÃªs
   (7%)
   </a>
   </span>

   </li>
   

   <li >

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.sr_Latn.html">sr_Latn</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.sr_Latn.html">Serbian(Latin)
   (0%)
   </a>
   </span>

   </li>
   

   <li >

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.tr.html">tr</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.tr.html">Turkish
   (7%)
   </a>
   </span>

   </li>
   

   <li >

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.ru.html">ru</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.ru.html">Russian
   (16%)
   </a>
   </span>

   </li>
   

   <li >

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.zh.html">zh</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.zh.html">Chinese
   (7%)
   </a>
   </span>

   </li>
   

   <li >

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.zh_TW.html">zh_TW</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.zh_TW.html">Chinese(Taiwan)
   (12%)
   </a>
   </span>

   </li>
   
</ul>
</div>







</div>



<div class="sidebar" role="navigation">
<div class="download button">
  <a href="../install.ar.html"><span class="download">Install</span>
    <span class="tails">Tails 
3.9
</span>
    <span class="date">
2018-09-05</span></a>
</div>




<div class="links">
  <ul>
    <li><a href="../about.ar.html">About</a></li>
    <li><a href="../getting_started.ar.html">Getting started…</a></li>
    <li><a href="../doc.ar.html">Documentation</a></li>
    <li><a href="../support.ar.html">Help &amp; Support</a></li>
    <li><a href="../contribute.ar.html">Contribute</a></li>
    <li><a href="../news.ar.html">News</a></li>
  </ul>
</div>




<div class="donate button">
    <a href="https://tails.boum.org/donate?r=sidebar">Donate</a>
</div>


</div>



<div id="pagebody">

<div id="content" role="main">
<p>We discovered that <em>Claws Mail</em>, the email client in Tails, stores plaintext
copies of all emails on the remote IMAP server, including those that are
meant to be encrypted.</p>

<ul>
<li>When sending an email, <em>Claws Mail</em> copies the email in plaintext to
the sending queue of the IMAP server before encrypting the email.
<em>Claws Mail</em> deletes this plaintext copy after sending the email.</li>
<li><em>Claws Mail</em> drafts in plaintext on the server. An email can be
saved as draft either:

<ul>
<li>Manually by clicking on the <strong>Draft</strong> button when composing an email.</li>
<li>Automatically if you selected the <strong>automatically save message to
Draft folder</strong> option in the writing preferences. This option is
deselected by default in Tails.</li>
</ul>
</li>
</ul>


<p><strong>All users of <em>Claws Mail</em> using IMAP and its OpenPGP plug-in are affected.</strong></p>

<p>Users of <em>Claws Mail</em> using POP are not affected.</p>

<div class="tip">

To know if you are using IMAP or POP, choose <span class="menuchoice">
<span class="guimenu">Configuration</span>&nbsp;▸
<span class="guimenuitem">Edit accounts&hellip;</span></span> and refer
to the <span class="guilabel">Protocol</span> column in the list of
accounts.

</div>


<p>Unfortunately, we were not yet able to fix the problem automatically and for
everybody. This would require to either modify <em>Claws Mail</em> or to migrate to
a different application. Refer to the workarounds section to solve this
problem in your setup and please warn others around you.</p>

<div class="toc">
<ol>
	<li class="L1"><a href="#index1h1">Workarounds</a>
	<ol>
		<li class="L2"><a href="#index1h2">Verify the content of your Drafts folder</a>
		</li>
		<li class="L2"><a href="#index2h2">Use POP instead of IMAP</a>
		</li>
		<li class="L2"><a href="#index3h2">Use local Drafts and Queue folders</a>
		</li>
	</ol>
	</li>
	<li class="L1"><a href="#index2h1">Long term solution</a>
	</li>
	<li class="L1"><a href="#index3h1">Technical details</a>
	<ol>
		<li class="L2"><a href="#index4h2">Leak through the sending queue</a>
		</li>
	</ol>
	</li>
</ol>
</div>


<h1><a name="index1h1"></a>Workarounds</h1>

<h2><a name="index1h2"></a>Verify the content of your <strong>Drafts</strong> folder</h2>

<p>First of all, verify the content of the <strong>Drafts</strong> folder on the server,
either through <em>Claws Mail</em> or through the web interface of your email
provider. Delete any plaintext email that might have been stored against
your will in this folder until now.</p>

<p>Then apply one of the other two workarounds to prevent more leaks in the
future.</p>

<h2><a name="index2h2"></a>Use POP instead of IMAP</h2>

<p><em>Claws Mail</em> can connect to the email server using either the IMAP or POP
protocol.</p>

<ul>
<li>With IMAP, <em>Claws Mail</em> constantly synchronizes with the server and
displays the emails and folders that are currently stored on the
server. IMAP is better suited if you access your emails from different
operating systems.</li>
<li>With POP, <em>Claws Mail</em> downloads the emails that are in the inbox on the
server and possibly removes them from the server. POP is better suited
if you access emails from Tails only and store them in the persistent
volume.</li>
</ul>


<p>To know more, see also this Yahoo! Help page on <a href="https://help.yahoo.com/kb/mail-for-desktop/compare-differences-pop-imap-sln3769.html">comparing the differences
between POP and
IMAP</a>.</p>

<p>POP is not affected at all by this security problem. When using POP, only
encrypted emails are sent to the server. So consider switching to POP if you
have an email account dedicated to your activities on Tails.  To do so:</p>

<ol>
<li><p>Choose <strong>File</strong>&nbsp;▸ <strong>Add mailbox</strong>&nbsp;▸ <strong>MH&hellip;</strong> to
create a local mailbox where to download your emails.</p></li>
<li><p>To store the mailbox in the persistent volume, specify
<span class="command">.claws-mail/Mail</span> as location.
Make sure to type the <span class="command">.</span> before
<span class="command">claws-mail/Mail</span>.</p>

<p> <img src="./claws_mail_leaks_plaintext_to_imap/add_mailbox.png" width="355" height="246" class="img" /></p></li>
<li><p>Choose <strong>Configuration</strong>&nbsp;▸ <strong>Edit accounts&hellip;</strong>, select
your IMAP account in the list of accounts, and click <strong>Delete</strong> to
delete it. Doing so does not delete any email stored on the server.</p></li>
<li><p>Click <strong>New</strong> and configure this new account as specified by your
email provider.</p>

<ul>
<li>In the <strong>Basic</strong> tab, make sure that the <strong>Protocol</strong> option is set to
<strong>POP3</strong>.</li>
<li><p>In the <strong>Receive</strong> tab, click on the <strong>Browse</strong> button of the <strong>Default
Inbox</strong> option and select the <strong>Inbox</strong> folder of the mailbox that you
created in step 2.</p>

<p><img src="./claws_mail_leaks_plaintext_to_imap/select_inbox.png" width="302" height="318" class="img" /></p></li>
<li><p>If you want to keep a copy of the received emails on the server, verify
the preferences in the <strong>Receive</strong> tab. We recommend you to disable the
<strong>Remove messages on server when received</strong> option until you make sure
that the emails are stored in the persistent volume.</p></li>
</ul>
</li>
<li><p>Close the preferences dialog and the list of accounts to go back to
the main window of <em>Claws Mail</em>.</p></li>
<li><p>Click on the <strong>Get Mail</strong> button to download all emails from the
inbox on the server. Emails in other folders are not downloaded.</p></li>
</ol>


<h2><a name="index3h2"></a>Use local <strong>Drafts</strong> and <strong>Queue</strong> folders</h2>

<p>If you want to continue using IMAP, you should configure your IMAP account
to use <strong>Drafts</strong> and <strong>Queue</strong> folders stored in Tails instead of on the
server. To do so:</p>

<ol>
<li><p>Choose <strong>Add mailbox</strong>&nbsp;▸ <strong>MH&hellip;</strong> to create a local
mailbox where to save your drafts and queued emails.</p></li>
<li><p>To store the mailbox in the persistent volume, specify
<span class="command">.claws-mail/Mail</span> as location.
Make sure to type the <span class="command">.</span> before
<span class="command">claws-mail/Mail</span>.</p>

<p> <img src="./claws_mail_leaks_plaintext_to_imap/add_mailbox.png" width="355" height="246" class="img" /></p></li>
<li><p>Choose <strong>Configuration</strong>&nbsp;▸ <strong>Edit accounts&hellip;</strong>, select
your IMAP account in the list of accounts, and click <strong>Edit</strong> to edit
its preferences.</p></li>
<li><p>Select <strong>Advanced</strong> in the left pane.</p></li>
<li><p>Select the <strong>Put queued messages in</strong> option, click <strong>Browse</strong>, and
select the <strong>Queue</strong> folder of the <strong>MH</strong> mailbox.</p></li>
<li><p>Select the <strong>Put draft messages in</strong> option, click <strong>Browse</strong>, and
select the <strong>Drafts</strong> folder of the <strong>MH</strong> mailbox.</p></li>
</ol>


<p><img src="./claws_mail_leaks_plaintext_to_imap/local_folders.png" width="551" height="221" class="img" /></p>

<h1><a name="index2h1"></a>Long term solution</h1>

<p>As for the possible long term solutions to this problem, we are considering:</p>

<ul>
<li><p>Getting the development team of <em>Claws Mail</em> to <a href="http://www.thewildbeast.co.uk/claws-mail/bugzilla/show_bug.cgi?id=2965">fix the problem
upstream</a>.
We contacted them about this problem already. Please help them provide a
technical solution if you can.</p></li>
<li><p>Replacing <em>Claws Mail</em> with <em>Icedove</em> (the name of <em>Mozilla Thunderbird</em>
in Debian). We have been willing to do so for years and this problem
motivates us to move faster.</p></li>
</ul>


<h1><a name="index3h1"></a>Technical details</h1>

<h2><a name="index4h2"></a>Leak through the sending queue</h2>

<p>When sending an email from an IMAP account, <em>Claws Mail</em> does the following:</p>

<ol>
<li><p>It connects to the IMAP server and stores a plaintext copy of the
email in the <strong>Queue</strong> folder on the server.</p></li>
<li><p>It encrypts the email locally.</p></li>
<li><p>It sends the encrypted email through the SMTP server.</p></li>
<li><p>It connects to the IMAP server and stores an encrypted copy of the
email in the <strong>Sent</strong> folder on the server.</p></li>
<li><p>It connects to the IMAP server and deletes the plaintext email
saved in step 1 from the <strong>Queue</strong> folder.</p></li>
</ol>


</div>







</div>

<div id="footer" class="pagefooter" role="contentinfo">

<div id="pageinfo">





<div class="tags">
Tags:

<a href="../tags/security/fixed.html" rel="tag">security/fixed</a>

</div>



<div id="backlinks">
Pages linking to this one:

<a href="../contribute/reports/SponsorS/2015/2015_01-07.html">contribute/reports/SponsorS/2015/2015 01-07</a>

<a href="../news/report_2015_05.html">news/report 2015 05</a>

<a href="../news/version_1.4.html">news/version 1.4</a>


</div>






</div>
<div id="mirrorlist">Mirror: <a href="https://tails.boum.org/ikiwiki.cgi?do=goto&page=security/claws_mail_leaks_plaintext_to_imap.ar">tails.boum.org</a></div>

<!-- from The Amnesic Incognito Live System -->
</div>

</div>

<script type="text/javascript">
  var linkelements = document.querySelectorAll('.use-mirror-pool');
  if(linkelements.length > 0) {
    replaceUrlPrefixWithRandomMirror(linkelements);
  }
</script>

</body>
</html>
