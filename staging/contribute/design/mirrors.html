<!DOCTYPE html>

<html lang="en" dir="ltr" xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tails - HTTP mirror pool</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="icon" href="../../favicon.ico" type="image/x-icon" />

<link rel="stylesheet" href="../../style.css" type="text/css" />

<link rel="stylesheet" href="../../local.css" type="text/css" />


<script src="../../lib/js/mirror-dispatcher.js" type="text/javascript"></script>









</head>


<body class="en">


<div class="searchform">



</div>

<div class="banner" role="banner">
  <a class="tails" href="../../index.en.html">
    <span class="acronym">Tails</span><br/>
    <span class="slogan">The Amnesic Incognito Live System</span>
  </a>
</div>

<div class="page">

<div class="pageheader">
<div class="header">
<span>
<span class="parentlinks">
<ul id="crumbs">
<li><a href="../../index.en.html"><img src="../../lib/home.png"></a></li>







<li><a href="../../contribute.en.html">contribute</a></li>





<li><a href="../design.html">design</a></li>




<li>HTTP mirror pool</li>

</ul>
</span>
<span class="title">
HTTP mirror pool
</span>
</span>
</div>










</div>



<div class="sidebar" role="navigation">
<div class="download button">
  <a href="../../install.en.html"><span class="download">Install</span>
    <span class="tails">Tails 
3.9
</span>
    <span class="date">
2018-09-05</span></a>
</div>




<div class="links">
  <ul>
    <li><a href="../../about.en.html">About</a></li>
    <li><a href="../../getting_started.en.html">Getting startedâ€¦</a></li>
    <li><a href="../../doc.en.html">Documentation</a></li>
    <li><a href="../../support.en.html">Help &amp; Support</a></li>
    <li><a href="../../contribute.en.html">Contribute</a></li>
    <li><a href="../../news.en.html">News</a></li>
  </ul>
</div>




<div class="donate button">
    <a href="https://tails.boum.org/donate?r=sidebar">Donate</a>
</div>


</div>



<div id="pagebody">

<div id="content" role="main">
<h1>Big picture</h1>

<p>The Tails downloads are served using two different mirror pools,
depending on the use case:</p>

<ul>
<li><p>We have dispatcher code, in JavaScript, that dynamically modifies the
hostname in the URL of our ISO image,
so that each user is pointed to random mirror.</p>

<ul>
<li><a href="https://git-tails.immerda.ch/mirror-pool-dispatcher/">public read-only mirror of the Git repository</a></li>
<li>Vanilla JS (no frameworks)</li>
<li>The code is deployed live: <a href="https://tails.boum.org/lib/js/mirror-dispatcher.js">https://tails.boum.org/lib/js/mirror-dispatcher.js</a></li>
<li>The library code has two consumers:

<ul>
<li>our website, primarily on our <a href="./installation_assistant.html#download">download page</a> but also on announcements of
release candidates</li>
<li>Tails Upgrader, that runs the library code with Node.js</li>
</ul>
</li>
<li>Configuration for the JS is loaded from a JSON file hosted on our
website.
See <a href="./mirrors.html#configuration">the configuration section</a>
for details.</li>
</ul>
</li>
<li><p>A DNS Round Robin pool that points to a few (3-7) fast and
reliable mirrors. It is the fallback for some use cases. So we still
have a DNS dynamic update system, re-purposed from the one we already had
(<code>dl.amnesia.boum.org</code>). This fallback DNS pool is used:</p>

<ul>
<li>by people who do not use JS, when downloading from our website;</li>
<li>for the <a href="../../install/expert/usb.en.html">wget download option</a>.</li>
</ul>
</li>
</ul>


<p><a id="configuration"></a></p>

<h1>Mirror pool configuration</h1>

<p>The client dispatcher code fetches the mirror pool configuration file
from our website.</p>

<p>The configuration file is written in JSON, to avoid the
need to use a third-party parser.</p>

<p>The configuration file is stored in a dedicated Git repository
(<a href="https://git-tails.immerda.ch/mirror-pool">public read-only mirror</a>),
that is added to our website with the ikiwiki underlay mechanism.
Using a separate Git repository gives us finer-grained access control
possibilities in the long run, e.g. we may want to let people who
don't have commit access to Git maintain the mirrors pool. Note that
we'll need to serve the configuration file from outside our website if
we ever want to do so: an <em>underlay</em> can affect our website in ways
that are probably (almost?) as bad as what one can do with Git access
to the website itself.</p>

<p>The configuration file is essentially a list of mirrors, and for each
of them we need a few values:</p>

<ul>
<li><p>url_prefix: whatever needs to be pre-pended to the path to an ISO
(e.g. <code>/stable/tails-i386-2.0/tails-i386-2.0.iso</code>) that is shared
between all mirrors, to form a complete URL to that ISO; for
example:</p>

<ul>
<li>in the old mirror pool design, this would be
<code>http://dl.amnesia.boum.org/tails</code></li>
<li>in the new mirror pool design, this could be e.g.
<code>http://42.dl.amnesia.boum.org/tails</code> (for mirrors who want to
use the unique VirtualHost we provide them), or something they
deal with themselves, e.g. <code>https://mirrors.kernel.org/tails</code></li>
</ul>
</li>
<li><p>weight: the probability this mirror has to be picked by the
dispatcher code, expressed as a non-negative integer; weight
0 means that the mirror is currently disabled, and will never be
redirected to</p></li>
<li><p>email (optional): the email address of the mirror's operator</p></li>
<li><p>notes (optional): various additional notes that can be useful to
the managers of the mirror pool</p></li>
</ul>


<p>For a more formal, and probably more up-to-date definition of the data
model, better see
<a href="https://git-tails.immerda.ch/mirror-pool/tree/schema.json">its JSON schema</a>.</p>

<p>Here is
<a href="https://git-tails.immerda.ch/mirror-pool/tree/example-mirrors.json">an example configuration file</a>.</p>

</div>







</div>

<div id="footer" class="pagefooter" role="contentinfo">

<div id="pageinfo">







<div id="backlinks">
Pages linking to this one:

<a href="../how/mirror.html">how/mirror</a>

<a href="./verification_extension.html">verification extension</a>


</div>






</div>
<div id="mirrorlist">Mirror: <a href="https://tails.boum.org/ikiwiki.cgi?do=goto&page=contribute/design/mirrors">tails.boum.org</a></div>

<!-- from The Amnesic Incognito Live System -->
</div>

</div>

<script type="text/javascript">
  var linkelements = document.querySelectorAll('.use-mirror-pool');
  if(linkelements.length > 0) {
    replaceUrlPrefixWithRandomMirror(linkelements);
  }
</script>

</body>
</html>
