<!DOCTYPE html>

<html lang="en" dir="ltr" xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tails - Tor network configuration</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="icon" href="../../favicon.ico" type="image/x-icon" />

<link rel="stylesheet" href="../../style.css" type="text/css" />

<link rel="stylesheet" href="../../local.css" type="text/css" />


<script src="../../lib/js/mirror-dispatcher.js" type="text/javascript"></script>









</head>


<body class="en">


<div class="searchform">



</div>

<div class="banner" role="banner">
  <a class="tails" href="../../index.en.html">
    <span class="acronym">Tails</span><br/>
    <span class="slogan">The Amnesic Incognito Live System</span>
  </a>
</div>

<div class="page">

<div class="pageheader">
<div class="header">
<span>
<span class="parentlinks">
<ul id="crumbs">
<li><a href="../../index.en.html"><img src="../../lib/home.png"></a></li>







<li><a href="../../contribute.en.html">contribute</a></li>





<li><a href="../design.html">design</a></li>




<li>Tor network configuration</li>

</ul>
</span>
<span class="title">
Tor network configuration
</span>
</span>
</div>










</div>



<div class="sidebar" role="navigation">
<div class="download button">
  <a href="../../install.en.html"><span class="download">Install</span>
    <span class="tails">Tails 
3.9
</span>
    <span class="date">
2018-09-05</span></a>
</div>




<div class="links">
  <ul>
    <li><a href="../../about.en.html">About</a></li>
    <li><a href="../../getting_started.en.html">Getting started…</a></li>
    <li><a href="../../doc.en.html">Documentation</a></li>
    <li><a href="../../support.en.html">Help &amp; Support</a></li>
    <li><a href="../../contribute.en.html">Contribute</a></li>
    <li><a href="../../news.en.html">News</a></li>
  </ul>
</div>




<div class="donate button">
    <a href="https://tails.boum.org/donate?r=sidebar">Donate</a>
</div>


</div>



<div id="pagebody">

<div id="content" role="main">


<div class="toc">
<ol>
	<li class="L1"><a href="#index1h1">Rationale</a>
	</li>
	<li class="L1"><a href="#index2h1">Implementation</a>
	</li>
</ol>
</div>


<h1><a name="index1h1"></a>Rationale</h1>

<p>Certain networks are restricted in ways that prevent Tor from
connecting properly without further configuration. Examples are:</p>

<ul>
<li><p>Egress port filtering (solved with <code>ReachableAddresses</code>).</p></li>
<li><p>The Internet is only reachable via a proxy (solved with the <code>*Proxy</code>
options).</p></li>
<li><p>Tor is explicitly blocked (the Tor people like the term "censored"),
which can be circumvented by using Tor bridges (solved with
<code>UseBridges</code>, <code>Bridge</code>, and possibly <code>ClientTransportPlugin</code>).</p></li>
</ul>


<p>In addition, bridges can be used to obfuscate Tor's traffic so that it
becomes harder for adversaries to identify Tor usage, especially in
combination with pluggable transports. This makes Tor (and hence
Tails) safer to use in regions where it's dangerous for some reason,
or in other situations where users want to hide that they use Tor. In
Tails we think this is a highly useful use case of Tor bridges beyond
its more publicly announced "censorship circumvention" usage.</p>

<p>In Tails we need a user-friendly and safe way for users to configure
these options before Tor tries to connect to the public Tor network.</p>

<h1><a name="index2h1"></a>Implementation</h1>

<p>In Tails Greeter the "Network Configuration" section contains a
non-default option called "My Internet Connection is
censored...". When activated, the following deviations from normal
Tails behaviour occur, in order:</p>

<ol>
<li><p>Tails Greeter adds <code>DisableNetwork 1</code> to torrc so Tor will not
connect to the network without user intervention.</p></li>
<li><p>The <code>tor</code> process is configured to not use the system resolver
(which is <code>tor</code> itself ⇒ catch-22) but the DNS server obtained by
NetworkManager instead. This enables the use of hostnames for
proxies and pluggable transports (which is required for e.g. Meek).</p></li>
<li><p>When we connect to the network, a NetworkManager hook starts Tor
Launcher in the background, i.e. non-blocking.</p></li>
<li><p><a href="./Time_syncing.html">Time syncing</a> waits until the user has committed their
configuration via Tor Launcher and then does its usual magic to
ensure that Tor bootstraps even if the clock was incorrect. That is
the reason why we have to take the more complex approach of
starting Tor Launcher in parallel.</p></li>
</ol>


<p>We install Tor Launcher by extracting it from the Tor Browser tarball,
when building the ISO image.</p>

<p>Scripts:</p>

<ul>
<li><p><a href="https://git-tails.immerda.ch/tails/plain/config/chroot_local-hooks/10-tbb">config/chroot local-hooks/10-tbb</a> (installs Tor Launcher)</p></li>
<li><p><a href="https://git-tails.immerda.ch/tails/plain/config/chroot_local-includes/usr/local/sbin/tails-tor-launcher">config/chroot local-includes/usr/local/sbin/tails-tor-launcher</a>
(Wrapper for Tor Launcher)</p></li>
<li><p><a href="https://git-tails.immerda.ch/greeter/plain/PostLogin.default">PostLogin.default</a> (sets <code>DisableNetwork</code>)</p></li>
<li><p><a href="https://git-tails.immerda.ch/tails/plain/config/chroot_local-includes/etc/NetworkManager/dispatcher.d/10-tor.sh">config/chroot local-includes/etc/NetworkManager/dispatcher.d/10-tor.sh</a>
(Tor Launcher is started here)</p></li>
<li><p><a href="https://git-tails.immerda.ch/tails/plain/config/chroot_local-includes/etc/NetworkManager/dispatcher.d/20-time.sh">config/chroot local-includes/etc/NetworkManager/dispatcher.d/20-time.sh</a>
(Time syncing)</p></li>
<li><p><a href="https://git-tails.immerda.ch/tails/plain/config/chroot_local-includes/lib/systemd/system/tor@default.service.d/writable-etc-tor.conf">config/chroot local-includes/lib/systemd/system/tor@default.service.d/writable-etc-tor.conf</a>
and <a href="https://git-tails.immerda.ch/tails/plain/config/chroot_local-patches/apparmor-adjust-tor-profile.diff">config/chroot local-patches/apparmor-adjust-tor-profile.diff</a>
(allow Tor to modify its configuration)</p></li>
</ul>


</div>







</div>

<div id="footer" class="pagefooter" role="contentinfo">

<div id="pageinfo">












</div>
<div id="mirrorlist">Mirror: <a href="https://tails.boum.org/ikiwiki.cgi?do=goto&page=contribute/design/Tor_network_configuration">tails.boum.org</a></div>

<!-- from The Amnesic Incognito Live System -->
</div>

</div>

<script type="text/javascript">
  var linkelements = document.querySelectorAll('.use-mirror-pool');
  if(linkelements.length > 0) {
    replaceUrlPrefixWithRandomMirror(linkelements);
  }
</script>

</body>
</html>
