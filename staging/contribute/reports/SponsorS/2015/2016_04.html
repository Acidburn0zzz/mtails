<!DOCTYPE html>

<html lang="en" dir="ltr" xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tails - Tails April 2016 report</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="icon" href="../../../../favicon.ico" type="image/x-icon" />

<link rel="stylesheet" href="../../../../style.css" type="text/css" />

<link rel="stylesheet" href="../../../../local.css" type="text/css" />


<script src="../../../../lib/js/mirror-dispatcher.js" type="text/javascript"></script>









</head>


<body class="en">


<div class="searchform">



</div>

<div class="banner" role="banner">
  <a class="tails" href="../../../../index.en.html">
    <span class="acronym">Tails</span><br/>
    <span class="slogan">The Amnesic Incognito Live System</span>
  </a>
</div>

<div class="page">

<div class="pageheader">
<div class="header">
<span>
<span class="parentlinks">
<ul id="crumbs">
<li><a href="../../../../index.en.html"><img src="../../../../lib/home.png"></a></li>







<li><a href="../../../../contribute.en.html">contribute</a></li>





<li><a href="../../../reports.html">reports</a></li>





<li><a href="../../SponsorS.html">SponsorS</a></li>





<li><a href="../../../../index.en.html">2015</a></li>




<li>Tails April 2016 report</li>

</ul>
</span>
<span class="title">
Tails April 2016 report
</span>
</span>
</div>










</div>



<div class="sidebar" role="navigation">
<div class="download button">
  <a href="../../../../install.en.html"><span class="download">Install</span>
    <span class="tails">Tails 
3.9
</span>
    <span class="date">
2018-09-05</span></a>
</div>




<div class="links">
  <ul>
    <li><a href="../../../../about.en.html">About</a></li>
    <li><a href="../../../../getting_started.en.html">Getting started…</a></li>
    <li><a href="../../../../doc.en.html">Documentation</a></li>
    <li><a href="../../../../support.en.html">Help &amp; Support</a></li>
    <li><a href="../../../../contribute.en.html">Contribute</a></li>
    <li><a href="../../../../news.en.html">News</a></li>
  </ul>
</div>




<div class="donate button">
    <a href="https://tails.boum.org/donate?r=sidebar">Donate</a>
</div>


</div>



<div id="pagebody">

<div id="content" role="main">


<div class="toc">
<ol>
	<li class="L1"><a href="#index1h1">A. Replace Claws Mail with Icedove</a>
	<ol>
		<li class="L2"><a href="#index1h2">A.1.1. Secure the Icedove autoconfig wizard (#6154)</a>
		</li>
		<li class="L2"><a href="#index2h2">A.1.2. Make our improvements maintainable for future versions of Icedove</a>
		</li>
		<li class="L2"><a href="#index3h2">Other Icedove-related work (out of the scope of this grant)</a>
		</li>
	</ol>
	</li>
	<li class="L1"><a href="#index2h1">B. Improve our quality assurance process</a>
	<ol>
		<li class="L2"><a href="#index4h2">B.1. Automatically build ISO images for all the branches of our source code that are under active development</a>
		</li>
		<li class="L2"><a href="#index5h2">B.2. Continuously run our entire test suite on all those ISO images once they are built</a>
		</li>
		<li class="L2"><a href="#index6h2">B.3. Extend the coverage of our test suite</a>
		</li>
		<li class="L2"><a href="#index7h2">B.4. Freezable APT repository</a>
		</li>
	</ol>
	</li>
	<li class="L1"><a href="#index3h1">C. Scale our infrastructure</a>
	<ol>
		<li class="L2"><a href="#index8h2">C.1. Change in depth the infrastructure of our pool of mirrors</a>
		</li>
		<li class="L2"><a href="#index9h2">C.2. Be able to detect within hours failures and malfunction on our services</a>
		</li>
		<li class="L2"><a href="#index10h2">C.4. Maintain our already existing services</a>
		</li>
	</ol>
	</li>
	<li class="L1"><a href="#index4h1">E. Release management</a>
	</li>
</ol>
</div>


<p>This report covers the activity of Tails in April 2016. We had
a quarterly milestone (V) ending in April, so we are also summing up
the status of our projects and deliverables at the end of
this milestone.</p>

<p>Everything in this report is public.</p>

<h1><a name="index1h1"></a>A. Replace Claws Mail with Icedove</h1>

<h2><a name="index1h2"></a>A.1.1. Secure the Icedove autoconfig wizard (<a href="https://labs.riseup.net/code/issues/6154">#6154</a>)</h2>

<p>Our modifications to secure the Icedove autoconfig wizard have been
merged into TorBirdy. A new version of TorBirdy is yet to be released
though. We are currently undecided if we want to update the TorBirdy
Debian package until this happens, or wait until we can package the
new upstream release.</p>

<p>TorBirdy disables Thunderbird's autoconfig wizard by default, and in
order not to lose TorBirdy's secure options, we made some changes for
Tails to be able to use the wizard, while still proposing only
secure options.</p>

<p>What these patches do:</p>

<ul>
<li>Use Tor's SOCKSPort for Enigmail's keyserver configuration.
It's not necessarily the case that users have a HTTP proxy running
on port 8118, and if they do it may be a non-torified one.
Using the Tor's SOCKSPort will always work, and be torified.</li>
<li>Always disable remote account creation. If that is something
TorBirdy developers
want to make enabled as an option, it should be handled separately
from the autoconfig wizard. This fixes Tails bug <a href="https://labs.riseup.net/code/issues/10464">#10464</a>.</li>
<li>Do not check for new messages at startup.</li>
</ul>


<p>Our current plan is to include modified versions of TorBirdy and
Icedove in Tails 2.4, so that we can enable the secured autoconfig
wizard, improve user experience and complete this deliverable.</p>

<h2><a name="index2h2"></a>A.1.2. Make our improvements maintainable for future versions of Icedove</h2>

<p>In order to make our improvements maintainable for future versions of
Icedove, we've submitted our patches upstream, as reported earlier.
They are currently still being reviewed but we are happy to announce
that there has been a
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=971347#c34">little progress</a>
on this
process. We will follow up on this very closely in order to obtain
a common strategy and provide these secure options to all
Thunderbird and Icedove users.</p>

<p>However, Thunderbird's upstream is still in the process of being
reorganized since Mozilla has announced to give the project a new home.
That might explain why review processes take quite some time. Thus, we
assume that our modifications will likely not be merged before we
release Tails 2.4. That's why we've now decided, against our previous
decision, to ship our own, modified Icedove and TorBirdy until
everything has been merged upstream.</p>

<h2><a name="index3h2"></a>Other Icedove-related work (out of the scope of this grant)</h2>

<p>What's not been done yet is to provide an AppArmor profile for the
Icedove Debian package. However, progress has been made on this front
too: the profile made by Simon Déziel has been reviewed and merged
into AppArmor upstream already. That means it will now be very easy
for us to provide a patch and ship this profile in Tails.</p>

<h1><a name="index2h1"></a>B. Improve our quality assurance process</h1>

<h2><a name="index4h2"></a>B.1. Automatically build ISO images for all the branches of our source code that are under active development</h2>

<p>In April, <strong>779 ISO images</strong> were automatically built by our Jenkins
instance.</p>

<h2><a name="index5h2"></a>B.2. Continuously run our entire test suite on all those ISO images once they are built</h2>

<p>In April, <strong>778 ISO images</strong> were automatically tested by our Jenkins
instance.</p>

<ul>
<li><p>B.2.4. Implement and deploy the best solution from this research: <a href="https://labs.riseup.net/code/issues/5288">#5288</a></p>

<p>We closed a bug where our isotesters sometimes were not connecting
back to our Jenkins master after being rebooted, as it didn't
happen ever again. <a href="https://labs.riseup.net/code/issues/10601">#10601</a></p>

<p>So, this deliverable is now completed.</p></li>
</ul>


<h2><a name="index6h2"></a>B.3. Extend the coverage of our test suite</h2>

<h3><a name="index1h3"></a>B.3.11. Fix newly identified issues to make our test suite more robust and faster</h3>

<ul>
<li><p>Robustness improvements</p>

<p>As discussed
<a href="./2016_03.html#index3h2">last month</a> and
the
<a href="./2016_02.html#index3h2">one before</a>, we
have continued trying out new "fundamental approaches" to deal with
our robustness issues. This month we have looked closer at the
"transient network issues", of which all seem to be related to using
the real Tor network. Our solution ended up being to run our own
miniature Tor network on the automated test suite host using the Tor
project's own tool for running Tor network diagnostic tests,
<a href="https://gitweb.torproject.org/chutney.git">Chutney</a>. (<a href="https://labs.riseup.net/code/issues/9521">#9521</a>)</p>

<p>The Tor client shipped in Tails is hardcoded to use the real Tor
network, but after we carefully "patch" it to use our Tor network
during tests, everything is essentially identical to the real thing
from Tails' perspective, so we can trust the testing
results. Initial test results are very positive -- so far no
Tor-related test failures have been observed with this approach, so
it seems sufficient for our immediate needs. On the bonus-side, we
now have some of the features and systems in place required for our
long-term goal of running all network services locally for even more
control, performance and (most importantly) increased
reliability. (<a href="https://labs.riseup.net/code/issues/9519">#9519</a>, <a href="https://labs.riseup.net/code/issues/9520">#9520</a>)</p>

<p>This concludes our two experiments with new fundamental approaches,
of which both seem to be successes. The next two months will be used
to fully integrate them into our test suite, and use these new tools
to fix specific tests that we see still exhibiting these types of
robustness problems.</p></li>
</ul>


<h2><a name="index7h2"></a>B.4. Freezable APT repository</h2>

<p>First, note that in February, we shared
<a href="./2016_02.html#index4h2">updated development schedule</a>
for this project.</p>

<ul>
<li><p>B.4.1. Specify when we want to import foreign packages into which APT suites (<a href="https://labs.riseup.net/code/issues/9488">#9488</a>)
and B.4.4. Design freezable APT repository (<a href="https://labs.riseup.net/code/issues/9487">#9487</a>)</p>

<p>These were delivered in March.</p></li>
<li><p>B.4.2. Implement a mechanism to save the list of packages used at ISO build time (<a href="https://labs.riseup.net/code/issues/10748">#10748</a>, <a href="https://labs.riseup.net/code/issues/10749">#10749</a>)</p>

<p>We still have to do some polishing but are happy with how this component
works now.</p>

<p>In April, we focused on C.1 (Change in depth the infrastructure of
our pool of mirrors) so much that we did not manage to polish this
in time for Tails 2.3. So, we now aim to get this merged in time for
Tails 2.4.</p>

<p>This will allow us to store, virtually forever, all the packages needed to build
a given Tails release.</p></li>
<li><p>B.4.3. Centralize and merge the list of needed packages</p>

<p>As <a href="./2016_03.html#index4h2">explained last month</a>,
the original definition of this deliverable doesn't make sense
anymore, so here we are reporting about what now replaces it:</p>

<ul>
<li><p>Allow storing APT snapshots longer than the default when needed. For
example to store the snapshots used during a code freeze that lasts
longer than usual and prevent them from being deleted by our garbage
collector: the
<a href="https://git-tails.immerda.ch/puppet-tails/tree/files/reprepro/snapshots/time_based/tails-bump-apt-snapshot-valid-until">corresponding script</a>
was tested and works fine.</p></li>
<li><p>Freeze and unfreeze the APT snapshots used by a branch when
needed: the
<a href="https://git-tails.immerda.ch/tails/tree/auto/scripts/apt-snapshots-serials?h=feature/build-from-snapshots">corresponding script</a>
passed early testing in March, but we did not work on it April.
This will be one of our main focuses in May.</p></li>
</ul>
</li>
<li><p>B.4.5. Implement processes and tools for importing and freezing those packages (<a href="https://labs.riseup.net/code/issues/6299">#6299</a>, <a href="https://labs.riseup.net/code/issues/6296">#6296</a>)</p>

<p>This infrastructure is described with and managed by a <a href="https://git-tails.immerda.ch/puppet-tails/tree/manifests/reprepro">Puppet
manifest</a>.</p>

<p>Time-based snapshots have been generated four times a day and
<a href="http://time-based.snapshots.deb.tails.boum.org/">published over HTTP</a>
since months now. This has proven to be solid.</p>

<p>The last remaining bits here are about handling some consequences on
this system:</p>

<ul>
<li><p>The process for garbage collecting these snapshots was designed in March,
and the
<a href="https://git-tails.immerda.ch/puppet-tails/tree/files/reprepro/snapshots/time_based/tails-delete-expired-apt-snapshots">implementation</a>
was completed in April. Spoiler alert: this was deployed in
production in May, and works fine.</p></li>
<li><p>Manage a very custom configuration for <code>apt-cacher-ng</code>, the
caching proxy used to speed up building Tails ISO images, to make
it compatible with our time-based snapshots (see last month's
report for details): our proof-of-concept works, we now need to
integrate it into the various configuration used to build a Tails
ISO image.</p></li>
<li><p><code>reprepro</code>'s database grows relatively quickly, which at some
point creates performance issues on our server, once this system
has been running for months; we have set up an Icinga2 check to
keep an eye of the size of this database, and have researched how
to compact that database, together with <code>reprepro</code>'s upstream
author. Our current best solution works well, and we now need to
document the process so that our system administrators know how to
apply it when needed.</p></li>
</ul>
</li>
<li><p>B.4.6. Adjust the rest of our ecosystem to the freezable APT repository (<a href="https://labs.riseup.net/code/issues/6303">#6303</a>)</p>

<p>The last remaining tiny blocker was completed in April, so this
deliverable is now done.</p></li>
</ul>


<h1><a name="index3h1"></a>C. Scale our infrastructure</h1>

<h2><a name="index8h2"></a>C.1. Change in depth the infrastructure of our pool of mirrors</h2>

<ul>
<li><p>C.1.1. Specify a way of describing the pool of mirrors (<a href="https://labs.riseup.net/code/issues/8637">#8637</a>, <a href="https://labs.riseup.net/code/issues/10284">#10284</a>)</p>

<p>As reported last month, this deliverable is done.</p></li>
<li><p>C.1.2. Write &amp; audit the code that makes the redirection decision from our website (<a href="https://labs.riseup.net/code/issues/8639">#8639</a>, <a href="https://labs.riseup.net/code/issues/8640">#8640</a>, <a href="https://labs.riseup.net/code/issues/11109">#11109</a>)</p>

<p>The <code>mirror-dispatcher.js</code> library code was written, tested and
reviewed in April. An initial security audit was conducted, and
following up on it we have been busy implementing the auditor's
recommendations. We are now waiting for the auditor to do
a final review.</p>

<p>We started modifying our Download And Verification Extension for
Firefox to make it use the same redirection code. The general use
case is now supported, using our <code>mirror-dispatcher.js</code> library.
We now need to add support for resuming an existing download (that
may have been started using another mirror than the one we would
like to use this time). And then, we'll want other people to review
and audit our proposed changes.</p></li>
<li><p>C.1.3. Design and implement the mirrors pool administration process and tools (<a href="https://labs.riseup.net/code/issues/8638">#8638</a>, <a href="https://labs.riseup.net/code/issues/11122">#11122</a>, <a href="https://labs.riseup.net/code/issues/11054">#11054</a>, <a href="https://labs.riseup.net/code/issues/11335">#11335</a>)</p>

<p>We documented how our mirrors should be configured to be part of the
new pool of mirrors, and created the corresponding administration
process and tools. So this deliverable is now done.</p></li>
<li><p>C.1.4. Communicate with each mirror operator to adapt their configuration (<a href="https://labs.riseup.net/code/issues/8635">#8635</a>, <a href="https://labs.riseup.net/code/issues/11079">#11079</a>)</p>

<p>We asked mirror operators to adapt their configuration, and we are
pleased to say that their response time was excellent: 92% of them
have already applied the required changes. As a bonus, 59% of our
mirrors followed our suggestions and additionally set up HTTPS,
which paves the way towards a HTTPS-only pool of mirrors (this is
not part of this deliverable formally speaking, but still we did not
want to miss this opportunity of looking further ahead).</p>

<p>We still need to issue a call for more mirrors.</p></li>
<li><p>C.1.5. Deploy the script and the mirror pool description (<a href="https://labs.riseup.net/code/issues/8641">#8641</a>)</p>

<p>The script and mirror pool description are now live on our website,
so this deliverable is completed. They will be used in production
once C.1.6 is done as well.</p></li>
<li><p>C.1.6. Adjust download documentation to point to the mirror pool dispatcher's URL (<a href="https://labs.riseup.net/code/issues/8642">#8642</a>, <a href="https://labs.riseup.net/code/issues/11329">#11329</a>, <a href="https://labs.riseup.net/code/issues/10295">#10295</a>, <a href="https://labs.riseup.net/code/issues/11284">#11284</a>)</p>

<p>We prepared branches of our website that make all links pointing to
our mirror pool use the new redirection system, and let our
documentation writers know how they should implement such links in
the future.</p>

<p>Actual deployment is now only blocked by:</p>

<ul>
<li>One last round of audit of our redirection code (see C.1.2).</li>
<li>Prepare our new fallback pool based on DNS, that will be used by
users who have JavaScript disabled in their web browser.</li>
</ul>
</li>
<li><p>C.1.7. Adjust update-description files for incremental upgrades (<a href="https://labs.riseup.net/code/issues/11123">#11123</a>)</p>

<p>With our current design, the original definition of this deliverable
doesn't make sense anymore. Instead, we have adjusted the code of
Tails Upgrader to use the new mirror pool. This code was tested, and
is now waiting to be reviewed and merged.</p></li>
<li><p>C.1.8. Clean up the remainers of the old mirror pool setup (<a href="https://labs.riseup.net/code/issues/8643">#8643</a>)</p>

<p>This is currently blocked by C.1.6.</p></li>
</ul>


<p>Scheduling-wise, our goals are unchanged since last month: we still
aim to deploy the new mirror pool in May but, if we are delayed, the
deployment might have to wait until July.</p>

<h2><a name="index9h2"></a>C.2. Be able to detect within hours failures and malfunction on our services</h2>

<p>The complete monitoring system was deployed to production, and works
very well so far. So, we consider this deliverable as completed.</p>

<ul>
<li><p>C.2.2. Set up the monitoring software and the underlying infrastructure</p>

<p>In April, we had only a little bit of polishing left to do on
this front.</p>

<p>We polished the Puppet code used to deploy the VPN between the
monitoring host and the monitored ones. <a href="https://labs.riseup.net/code/issues/11094">#11094</a></p>

<p>We configured the Icinga2 agents on the remaining half of our
systems. This allowed us to validate our corresponding Puppet code.</p>

<p>We set up different accounts for each system administrators, so that
they can use more efficiently Icingaweb2's integrated discussion
feature to comment on problems. <a href="https://labs.riseup.net/code/issues/11282">#11282</a></p>

<p>We also defined some relevant host groups and service groups, that will ease
scheduling downtimes, e.g. for an entire virtualization host.
<a href="https://labs.riseup.net/code/issues/11277">#11277</a></p>

<p>We disabled the statistics history feature that we don't use, in
order to save disk space. <a href="https://labs.riseup.net/code/issues/11368">#11368</a></p></li>
<li><p>C.2.4. Configure and debug the monitoring of the most critical
services and C.2.6. Configure and debug the monitoring of other
high-priority services</p>

<p>We wrote the last two Icinga2 custom plugins that we needed: one
checking if our SSH and SFTP accounts used by our automatic tests are
working, and another one checking if our SMTP Onion Service used by our
WhisperBack bug reporting tool is available.
<a href="https://labs.riseup.net/code/issues/8650">#8650</a> and <a href="https://labs.riseup.net/code/issues/8653">#8653</a></p>

<p>As during March, Icinga2 already warned us of some problems in our
infrastructure. Some of our partitions were close to be filled and we
were able to fix them before it became a problem. Most notably, it
helped us notice that the Tor daemon running our SMTP Onion
Service was not upgraded to the right version when its host was,
leading to crashes (and restarts) of the Tor daemon every few
minutes, rendering the service not so
reliable. We fixed that by upgrading the Tor daemon.</p>

<p>We've then reviewed every checks to define the frequency they should
be run at, and the number of retries after which our system
administrators shall be notified. We came up with an agreement that
was promptly implemented, and refined after a few days of
evaluation. <a href="https://labs.riseup.net/code/issues/11358">#11358</a></p>

<p>In the end, all of the high-prirority and critical checks were
deployed early April, and we're now running 79 different checks on 19
different hosts.</p></li>
<li><p>C.2.5. Configure the receiving side of the monitoring notifications</p>

<p>In April, we enabled email notifications from Icinga2 to our main
monitoring developer's email address, so that we could evaluate
their volume and delay. This helped us refine checks' frequency, and
at the end of the month we concluded that the signal/noise ratio was
good enough for us to release the email notifications to our entire
team of system administrators. <a href="https://labs.riseup.net/code/issues/8651">#8651</a></p></li>
</ul>


<h2><a name="index10h2"></a>C.4. Maintain our already existing services</h2>

<ul>
<li><p>C.4.5. Administer our services upto milestone V</p>

<p>We kept on answering the requests from the community and taking
care of security updates as covered by "C.4.5. Administer our services
up to milestone V".</p>

<p>We fixed the Postfix configuration of our monitoring host that was
spamming us for every emails it sent because IPv6 is disabled on this
host. <a href="https://labs.riseup.net/code/issues/11342">#11342</a></p></li>
</ul>


<h1><a name="index4h1"></a>E. Release management</h1>

<p><a href="../../../../news/version_2.3.en.html">Tails 2.3</a> was released on April 26.</p>

</div>







</div>

<div id="footer" class="pagefooter" role="contentinfo">

<div id="pageinfo">







<div id="backlinks">
Pages linking to this one:

<a href="./2016_05.html">2016 05</a>

<a href="../../../../news/report_2016_04.html">news/report 2016 04</a>


</div>






</div>
<div id="mirrorlist">Mirror: <a href="https://tails.boum.org/ikiwiki.cgi?do=goto&page=contribute/reports/SponsorS/2015/2016_04">tails.boum.org</a></div>

<!-- from The Amnesic Incognito Live System -->
</div>

</div>

<script type="text/javascript">
  var linkelements = document.querySelectorAll('.use-mirror-pool');
  if(linkelements.length > 0) {
    replaceUrlPrefixWithRandomMirror(linkelements);
  }
</script>

</body>
</html>
