<!DOCTYPE html>

<html lang="en" dir="ltr" xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tails - Releasing Thunderbird</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="icon" href="../../favicon.ico" type="image/x-icon" />

<link rel="stylesheet" href="../../style.css" type="text/css" />

<link rel="stylesheet" href="../../local.css" type="text/css" />


<script src="../../lib/js/mirror-dispatcher.js" type="text/javascript"></script>









</head>


<body class="en">


<div class="searchform">



</div>

<div class="banner" role="banner">
  <a class="tails" href="../../index.en.html">
    <span class="acronym">Tails</span><br/>
    <span class="slogan">The Amnesic Incognito Live System</span>
  </a>
</div>

<div class="page">

<div class="pageheader">
<div class="header">
<span>
<span class="parentlinks">
<ul id="crumbs">
<li><a href="../../index.en.html"><img src="../../lib/home.png"></a></li>







<li><a href="../../contribute.en.html">contribute</a></li>





<li><a href="../release_process.html">release process</a></li>




<li>Releasing Thunderbird</li>

</ul>
</span>
<span class="title">
Releasing Thunderbird
</span>
</span>
</div>










</div>



<div class="sidebar" role="navigation">
<div class="download button">
  <a href="../../install.en.html"><span class="download">Install</span>
    <span class="tails">Tails 
3.9
</span>
    <span class="date">
2018-09-05</span></a>
</div>




<div class="links">
  <ul>
    <li><a href="../../about.en.html">About</a></li>
    <li><a href="../../getting_started.en.html">Getting startedâ€¦</a></li>
    <li><a href="../../doc.en.html">Documentation</a></li>
    <li><a href="../../support.en.html">Help &amp; Support</a></li>
    <li><a href="../../contribute.en.html">Contribute</a></li>
    <li><a href="../../news.en.html">News</a></li>
  </ul>
</div>




<div class="donate button">
    <a href="https://tails.boum.org/donate?r=sidebar">Donate</a>
</div>


</div>



<div id="pagebody">

<div id="content" role="main">
<p>Until we have
<a href="https://labs.riseup.net/code/issues/6156">upstreamed our secure autoconfiguration patches</a>
we have to maintain Thunderbird ourselves. This means we need to
<a href="https://tracker.debian.org/pkg/thunderbird">thunderbird</a> new versions hitting Debian stable.</p>

<p>The first time you do this requires some additional steps (WARNING!
this will download almost 2 GiB of data):</p>

<ol>
<li><p>Clone <a href="http://git.tails.boum.org/thunderbird/">Tails' Thunderbird repo</a>.</p></li>
<li><p>Add a remote for Debian:</p>

<pre><code> git remote add debian-upstream https://salsa.debian.org/mozilla-team/thunderbird.git
</code></pre></li>
</ol>


<p>Let's pretend the scenario is that Thunderbird 52.3.0-4~deb9u1 has just been
released:</p>

<pre><code>VERSION="52.3.0-4~deb9u1"
TAG="debian/1%$(echo ${VERSION:?} | tr '~' '_')"
UPSTREAM_VERSION=$(echo ${VERSION:?} | perl -pi -E 's/-.*//')
</code></pre>

<ol>
<li><p><code>git fetch &amp;&amp; git fetch debian-upstream</code></p></li>
<li><p>Verify the signed tag:</p>

<pre><code> git tag -v "${TAG:?}"
</code></pre>

<p>The tag should have been signed with one of the keys that follow;
investigate if it's not the case:</p>

<ul>
<li><code>8B94 819C 2555 70A3 74B6  2CCD 26E3 C875 A744 20EF</code></li>
<li><code>B70D FC6F 134F ECFC 011E  62AA 8301 6014 251D 1DB0</code></li>
<li><code>D343 9DAA 19DC FACD AE87  9CF2 B999 CDB5 8C8D DBD2</code></li>
</ul>
</li>
<li><p>Let's update our branch to the new version:</p>

<pre><code> git checkout tails/stretch &amp;&amp; git merge origin/tails/stretch &amp;&amp; \
 git merge --no-edit "${TAG:?}"
</code></pre>

<p>Now you most likely will have to deal with a merge conflict in
<code>debian/changelog</code> -- just reorder the conflicting entries by
version number, <code>git add</code> modified files as needed, and ensure
a merge commit is created eventually.</p></li>
<li><p>Let's ensure our patches still apply cleanly:</p>

<ol>
<li><p>Check if they do:</p>

<pre><code>quilt push -a
</code></pre></li>
<li><p>Regardless of whether our patches applied cleanly, clean up:</p>

<pre><code>quilt pop -a &amp;&amp; rm -rf .pc
</code></pre></li>
<li><p>If our patches applied cleanly, move on. Otherwise:</p>

<p>XXX (undocumented as we prefer focusing our efforts on
upstreaming our patches than on documenting the current,
temporary state of things): after reverse-engineering the state
of our Git repository, it seems that one should create a new
<code>secure_account_creation-${VERSION:?}</code> branch forked of the
latest existing one, transplant our commits on top of <code>${TAG}</code>
with the appropriate <code>--onto</code> option, squash our commits into
a new <code>secure_account_creation-${VERSION:?}-squashed</code> branch,
extract updated patches from there into
<code>debian/patches/secure-account-creation/</code>.</p></li>
</ol>
</li>
<li><p>Then let's release a new version:</p>

<pre><code> TAILS_VERSION="1:${VERSION:?}.0tails1" &amp;&amp; \
 DISTRIBUTION="bugfix-${TICKET:?}-thunderbird-${UPSTREAM_VERSION:?}" &amp;&amp; \
 dch \
    --newversion "${TAILS_VERSION:?}" \
    --force-bad-version \
    --distribution "${DISTRIBUTION:?}" \
    --force-distribution \
    "Rebuild with Tails' secure autoconfiguration patches." &amp;&amp; \
 git commit debian/changelog \
     -m "document changes and release ${TAILS_VERSION:?}"
</code></pre></li>
<li><p>Build packages in a Stretch amd64 chroot:</p>

<pre><code> gbp buildpackage \
     --git-debian-branch=tails/stretch \
     --git-export=WC
</code></pre></li>
<li><p>Tag the new version:</p>

<pre><code> gbp buildpackage --git-debian-branch=tails/stretch \
     --git-sign-tags --git-tag-only
</code></pre></li>
<li><p>If you've built a package based on an <em>upstream</em> release (as in:
what's before the first <code>-</code> in the package version number)
whose <code>.orig.tar.xz</code> tarball was never uploaded to our custom
APT repository, include all sources in the <code>.changes</code> file:</p>

<pre><code> cd path/to/build/artifacts/directory &amp;&amp; \
 cp path/to/build-area/*${UPSTREAM_VERSION:?}*.orig*.tar.xz . &amp;&amp; \
 CHANGES_FILE="thunderbird_$(echo "${TAILS_VERSION:?}" | sed 's/^1://')_amd64.changes" &amp;&amp; \
 changestool "${CHANGES_FILE:?}" includeallsources
</code></pre></li>
<li><p>Due to <a href="https://labs.riseup.net/code/issues/11531">#11531</a> we won't be able to push the tag
generated by <code>gbp</code> so we have to replace it with a differently
named tag:</p>

<pre><code> GBP_TAG="debian/$(echo ${TAILS_VERSION:?} | tr '~:' '_%')"
 NEW_GBP_TAG="$(echo ${GBP_TAG:?} | sed 's@/1%@/@')" &amp;&amp; \
 git tag -s "${NEW_GBP_TAG:?}" \
         -m "thunderbird Debian release 1:${TAILS_VERSION:?}" \
         "${GBP_TAG:?}"
</code></pre></li>
<li><p>Git push and upload packages:</p>

<pre><code> git push --follow-tags origin \
    ${NEW_GBP_TAG:?} \
    tails/stretch \
    upstream-60.x \
    pristine-tar &amp;&amp; \
 (cd /path/to/build/artifacts &amp;&amp; \
  debsign "${CHANGES_FILE:?}" &amp;&amp; \
  dupload --to tails "${CHANGES_FILE:?}")
</code></pre>

<p>Note: pushing some tags will fail due to <a href="https://labs.riseup.net/code/issues/11531">#11531</a>.</p></li>
</ol>


</div>







</div>

<div id="footer" class="pagefooter" role="contentinfo">

<div id="pageinfo">







<div id="backlinks">
Pages linking to this one:

<a href="../release_process.html">release process</a>


</div>






</div>
<div id="mirrorlist">Mirror: <a href="https://tails.boum.org/ikiwiki.cgi?do=goto&page=contribute/release_process/thunderbird">tails.boum.org</a></div>

<!-- from The Amnesic Incognito Live System -->
</div>

</div>

<script type="text/javascript">
  var linkelements = document.querySelectorAll('.use-mirror-pool');
  if(linkelements.length > 0) {
    replaceUrlPrefixWithRandomMirror(linkelements);
  }
</script>

</body>
</html>
